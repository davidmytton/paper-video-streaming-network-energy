# Traceroute Collector

Packaged code for the paper: `Network architecture of internet video streaming
over Wi-Fi and 4G - collection software and traceroute samples`.

## Abstract

The internet consists of multiple interlinked networks, and major video
streaming providers use sophisticated Content Delivery Networks to ensure data
are located closer to users. This can mean each user has a different network
path connecting their device to the content they wish to watch, which makes
mapping the network architecture difficult.  In this paper, we present a
methodology and software implementation to simulate YouTube and Instagram
internet video streaming workloads via human participants. We include 116
traceroute samples in standardised, machine-readable format collected from 29
participants using this methodology which can be used for analysis of internet
workloads, such as video streaming and media content distribution.

The code can be [found on
GitHub](https://github.com/davidmytton/traceroute-collector).

## Methods

1. Adverts were sent using convenience sampling to several groups the
   researchers were part of â€“ the Imperial College London Environmental
   Technology MSc 2019-2020 cohort, a private UK Chief Technology Officer user
   group (https://www.bartechcto.net), the Power Swarm network
   (http://powerswarm.co.uk), the ClimateAction.tech newsletter, Twitter, and
   personal contacts. Applicants were required to meet eligibility criteria:
   over 18, fluent English speakers, able to access the internet over Wi-Fi and
   4G with a macOS computer not using a VPN. Volunteers were asked to apply
   using a Microsoft Form, which also collected consent, Internet Service
   Provider (ISP) name, and city/country. Applications were open between 3 June
   2020 and 13 July 2020.
2. Eligible participants were sent instructions via email. Each participant
   downloaded a zip file with the Python script and Scamper binary. They were
   instructed to run the script once whilst connected to their home internet
   via Wi-Fi, disconnect from Wi-Fi, tether their phone over 4G and then run
   the script again
3. The trace results were written to JavaScript Object Notation (JSON) files
   which the participant was asked to email back to the researchers. The
   participant then deleted all the files.

### Content

YouTube, Netflix, Facebook Video and Instagram make up a majority of all
internet and mobile traffic (Sandvine,
[2019](https://www.sandvine.com/global-internet-phenomena-report-2019),
[2020](https://www.sandvine.com/download-report-mobile-internet-phenomena-report-2020-sandvine)).
Netflix and Facebook require accounts to log in so will be excluded.

* **YouTube**: The video "[Luis Fonsi - Despacito ft. Daddy
  Yankee](https://www.youtube.com/watch?v=kJQP7kiw5Fk)" was selected as the
  number 1 most viewed video on YouTube as of 2020-04-21.
* **Instagram**: The video "[snowboarding from Kylie
  Jenner](https://www.instagram.com/p/B5vhf4innBN/)" was selected as the first
  video on the list of [most liked Instagram
  posts](https://en.wikipedia.org/wiki/List_of_most-liked_Instagram_posts) as
  of 2020-04-15.

## Results

The results will be published with a link to the relevant paper [on
GitHub](https://github.com/davidmytton/traceroute-collector).

## Usage Instructions

### Requirements

* macOS.
  * Developed on macOS 10.15 with Python 3.7.6
  * Some participants reported problems with certificate validation on macOS
    10.12 and 10.13, which have outdated certificate repositories. [Upgrading
    the certificate store](https://stackoverflow.com/a/61142526) was tried but
    this didn't help. As such, certificate verification was disabled in the
    code.
* Python 3.6+.

### Setup

1. Extract the release zip file into a new directory. In a terminal, `cd` into
   that directory.
2. Execute: `python3 -m venv venv`. macOS may ask you to download the free
   developer tools from Apple. Allow this to run when prompted then run this
   command again.
3. Execute: `source venv/bin/activate`
4. Execute: `pip3 install -r requirements.txt`
5. Test the scamper binary: `./scamper`. macOS may block execution. If so, go
   to System Preferences > Security & Privacy > General then allow access.
   Execute `./scamper` again to verify.

### Execution

1. Connect your computer over Wi-Fi.
2. Execute: `sudo python3 main.py --connection wifi`
3. Disconnect from Wi-Fi. Connect by tethering to your 4G phone.
4. Execute: `sudo python3 main.py --connection 4g`

#### Output

Several files prefixed with `results-` will be produced. Example output is
provided in the [`example-results`](/example-results) directory.

`results-*-wifi.json` and `results-*-4g.json` contain the full technical traceroute details generated by scamper in JSON output mode. The public IP of the user is redacted if present.

## Analysing results

The results files are expected to use following naming convention:

`results-COUNTRY-CITY-DESTINATION-CONNECTION.json`

e.g. `results-uk-london-www.instagram.com-4g.json`

The [analysis script](/analyse.py) aggregates all the results files into a
single CSV.

`python3 analyse.py --results_dir example-results/ --ipinfo_key API_KEY`

### Parameters

`--results_dir` = the directory that contains all the Scamper results JSON
files.

`--ipinfo_key` = your API key for [ipinfo.io](https://ipinfo.io), used to look
up information about each trace IP address.

### Removal

1. Execute: `deactivate`
2. Then delete the folder that was extracted.

## Notes

* The `./scamper` binary is committed into the repo compiled on macOS 10.15.4
  (19E287) from the [2020-03-12
  scamper-cvs-20191102b](https://www.caida.org/tools/measurement/scamper/code/scamper-cvs-20191102b.tar.gz)
  release to avoid having to build a binary on a volunteer machine (or [install
  via homebrew](https://formulae.brew.sh/formula/scamper)).
* The code uses [jsonip.com](https://jsonip.com) to get the current public IP
  so it can be redacted from the results.
* If you are using something like Little Snitch, it needs to be completely
  disabled whilst running the tests because it interfers with the way that
  scamper manipulates the firewall.

## License

All the code in this repo is licensed under
[GPLv2](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html).

Scamper is provided in a unmodified, compiled binary executable as part of this
project. It is also licensed under
[GPLv2](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) and the
original code that was compiled is available from the [2020-03-12
scamper-cvs-20191102b](https://www.caida.org/tools/measurement/scamper/code/scamper-cvs-20191102b.tar.gz)
release, included in this repo as
[`scamper-cvs-20191102b.tar.gz`](/scamper-cvs-20191102b.tar.gz) for archive
purposes.
