# Traceroute Collector

Code for participants to run to collect the Scamper traceroutes for the paper:
`The network energy intensity of video streaming over Wi-Fi and 4G`.

## Usage Instructions

### Requirements

* macOS.
  * Developed on macOS 10.15 with Python 3.7.6
  * Some participants reported problems with certificate validation on macOS
    10.12 and 10.13, which have outdated certificate repositories. [Upgrading
    the certificate store](https://stackoverflow.com/a/61142526) was tried but
    this didn't help. As such, certificate verification was disabled in the
    code.
* Python 3.6+.

### Setup

1. Extract the release zip file into a new directory. In a terminal, `cd` into
   that directory.
2. Execute: `python3 -m venv venv`. macOS may ask you to download the free
   developer tools from Apple. Allow this to run when prompted then run this
   command again.
3. Execute: `source venv/bin/activate`
4. Execute: `pip3 install -r requirements.txt`
5. Test the scamper binary: `./scamper`. macOS may block execution. If so, go
   to System Preferences > Security & Privacy > General then allow access.
   Execute `./scamper` again to verify.

### Execution

1. Connect your computer over Wi-Fi.
2. Execute: `sudo python3 main.py --connection wifi`
3. Disconnect from Wi-Fi. Connect by tethering to your 4G phone.
4. Execute: `sudo python3 main.py --connection 4g`

#### Output

Several files prefixed with `results-` will be produced. Example output is
provided in the [`example-results`](/example-results) directory.

`results-*-wifi.json` and `results-*-4g.json` contain the full technical traceroute
details generated by scamper in JSON output mode. The public IP of the user is redacted
if present.

### Removal

1. Execute: `deactivate`
2. Then delete the folder that was extracted.

## Notes

* The `./scamper` binary is committed into the repo compiled on macOS 10.15.4
  (19E287) from the [2020-03-12
  scamper-cvs-20191102b](https://www.caida.org/tools/measurement/scamper/code/scamper-cvs-20191102b.tar.gz)
  release to avoid having to build a binary on a volunteer machine (or [install
  via homebrew](https://formulae.brew.sh/formula/scamper)).
* If you are using something like Little Snitch, it needs to be completely
  disabled whilst running the tests because it interfers with the way that
  scamper manipulates the firewall.

## License

All the code in this directory is licensed under
[GPLv3](https://www.gnu.org/licenses/gpl-3.0.txt).

Scamper is provided in a unmodified, compiled binary executable as part of this
project. It is licensed under
[GPLv2](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) and the
original code that was compiled is available from the [2020-03-12
scamper-cvs-20191102b](https://www.caida.org/tools/measurement/scamper/code/scamper-cvs-20191102b.tar.gz)
release, archived in this repo as
[`scamper-cvs-20191102b.tar.gz`](/scamper-cvs-20191102b.tar.gz).
